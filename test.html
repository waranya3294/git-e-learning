<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>อนุมัติการสอบพนักงาน</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.2.2/css/dataTables.bootstrap5.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.bootstrap5.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <!-- fontawsome -->
  <link rel="stylesheet" href="assets/lib/fontawsome/css/brands.css">
  <link rel="stylesheet" href="assets/lib/fontawsome/css/solid.css">
  <link rel="stylesheet" href="assets/lib/fontawsome/css/regular.css">
  <link rel="stylesheet" href="assets/lib/fontawsome/css/fontawesome.css">
  </head>

  <body>
    <div class="container mt-4">
      <div class="card shadow-sm rounded-0">
        <div class="card-header rounded-0 text-white text-start fs-5" style="background-color: #18B0BD;">
         <h4>ฟอร์มเลือกข้อมูลการสอบ</h4>
      </div>
          <div class="card-body">
              <div class="row">
                  <!-- เลือกประเภทการสอบ -->
                  <div class="col-md-4 mb-3">
                    <label for="examType" class="fw-bold"> เลือกประเภทการสอบ</label>
                    <select class="form-select" id="examType">
                        <option selected>--เลือกประเภทการสอบ--</option>
                        <option value="1">สี</option>
                        <option value="2">เชื่อม</option>
                        <option value="3">ประกอบ</option>
                        <option value="4">CNC</option>
                    </select>
                </div>
  
                  <!-- เลือกโรงงาน -->
                  <div class="col-md-4 mb-3">
                    <label for="factory" class="fw-bold">เลือกโรงงาน</label>
                    <select class="form-select" id="factory">
                        <option selected>--เลือกโรงงาน--</option>
                        <option value="1">TS (ตาสิทธิ์)</option>
                        <option value="2">PD (ปลวกแดง)</option>
                        <option value="3">ทั้งหมด</option>
                    </select>
                </div>
  
                  <!-- เลือกจุดปฏิบัติงาน -->
                  <div class="col-md-4">
                    <label class="fw-bold">เลือกจุดปฏิบัติงาน</label>
                    <div id="section" class="border rounded p-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="topcoat">
                            <label class="form-check-label" for="topcoat">Top coat</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="smallpart">
                            <label class="form-check-label" for="smallpart">Small Part</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="undercoat">
                            <label class="form-check-label" for="undercoat">Under Coat</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="finalpaint">
                            <label class="form-check-label" for="finalpaint">Final Paint</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="painting">
                            <label class="form-check-label" for="painting">Painting</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="selectAll">
                            <label class="form-check-label" for="selectAll">เลือกทั้งหมด</label>
                        </div>
                    </div>
                </div>
              </div>

              <label for="datetimes">เลือกวันที่: <span class="text-danger">*</span></label>
              <div class="row " id="dateFieldsContainer">
                  <div class="col-lg-6 d-flex align-items-center">
                      <div class="input-group mb-2">
                          <input type="text" id="datetimes" name="datetimes" class="form-control" required placeholder="เลือกช่วงเวลา" aria-describedby="exam_starttime_endtime">
                          <span class="input-group-text" id="exam_starttime_endtime" style="cursor: pointer;">
                              <i class="fa-solid fa-calendar-days"></i>
                          </span>
                      </div>
                  </div>
              </div>

              <div class="row">
                <div class="col text-center mt-4">
                  <button class="btn btn-lg btn-secondary" id="generatePDF"><i class="fa-solid fa-magnifying-glass"></i> แสดงข้อมูล</button>
                </div>
              </div>
          </div>
      </div>
  </div>

  <script>
 $(function() {
  // ตั้งค่าภาษาไทยใน moment.js
  moment.locale('th'); // ตั้งค่าให้ moment ใช้ภาษาไทย

  // Date range picker setup
  $('input[name="datetimes"]').daterangepicker({
    timePicker: true,
    startDate: moment().startOf('hour'),
    endDate: moment().startOf('hour').add(32, 'hour'),
    locale: {
      format: 'DD/MM/YYYY', // ฟอร์แมตวันที่
      applyLabel: 'ตกลง',
      cancelLabel: 'ยกเลิก',
      fromLabel: 'จาก',
      toLabel: 'ถึง',
      daysOfWeek: ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส'],
      monthNames: ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 
                   'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'],
      firstDay: 1 // ตั้งให้วันแรกเป็นวันจันทร์
    }
  });

  // Show/hide sections based on exam type
  $('#examType').change(function() {
    if ($(this).val() == '1') { // สี
      $('#section').show();
    } else {
      $('#section').hide();
    }
  });

  // ซ่อนส่วนของการเลือกจุดปฏิบัติงาน
  $('#section').hide();

  // ฟังก์ชัน "Select All" เพื่อเลือก/ยกเลิกเลือกทุกช่อง
  $('#selectAll').click(function() {
    $('input[type="checkbox"]').prop('checked', this.checked);
  });
});

document.addEventListener("DOMContentLoaded", function () {
  // สร้าง PDF เมื่อคลิกที่ปุ่ม "แสดงข้อมูล"
  document.getElementById("generatePDF").addEventListener("click", function () {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // โหลดฟอนต์ Sarabun VP (กรุณาแปลงฟอนต์เป็น base64 และเพิ่มไฟล์นี้ในโปรเจคต์)
    doc.addFileToVFS("SarabunVP-Regular.ttf", "base64_encoded_font_data"); // ใช้ base64 encoding ฟอนต์
    doc.addFont("SarabunVP-Regular.ttf", "SarabunVP", "normal");

    // ตั้งค่าให้ใช้ฟอนต์ Sarabun VP
    doc.setFont("SarabunVP");

    // เพิ่มข้อความใน PDF โดยใช้ฟอนต์ภาษาไทย
    doc.text("รายงานข้อมูลพนักงาน", 14, 10);

    // ข้อมูลที่จะใช้ใน PDF (แทนที่ด้วยข้อมูลจริง)
    const headers = [["รหัสพนักงาน", "ชื่อ - นามสกุล", "ตำแหน่ง","ฝ่าย", "แผนก", "จุดปฏิบัติงาน", "โรงงาน","วันที่จอง","รอบเวลา","สถานะ"]];
    const data = [
      //   ["001", "สมชาย", "ทองคำ", "ช่างเชื่อม", "ผลิต", "ฝ่าย A", "TS (ตาสิทธิ์)"],
      //   ["002", "สมหญิง", "เงินทอง", "ช่างสี", "คุณภาพ", "ฝ่าย B", "PD (ปลวกแดง)"]
    ];

    // ใช้ autoTable เพื่อแสดงข้อมูลในตาราง
    doc.autoTable({
      head: headers,
      body: data,
      startY: 20
    });

    // แสดง PDF ในหน้าต่างใหม่โดยไม่ต้องดาวน์โหลด
    const pdfData = doc.output('datauristring'); // สร้าง data URI string
    const pdfWindow = window.open();
    pdfWindow.document.write('<html><body><iframe width="100%" height="100%" src="' + pdfData + '"></iframe></body></html>');
  });
});

  </script>
  
  </body>
</html>
