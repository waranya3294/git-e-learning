<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>อนุมัติการสอบพนักงาน</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.2.2/css/dataTables.bootstrap5.css"
    />

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.bootstrap5.js"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.2.2/css/dataTables.bootstrap5.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- fontawsome -->
    <link rel="stylesheet" href="assets/lib/fontawsome/css/brands.css" />
    <link rel="stylesheet" href="assets/lib/fontawsome/css/solid.css" />
    <link rel="stylesheet" href="assets/lib/fontawsome/css/regular.css" />
    <link rel="stylesheet" href="assets/lib/fontawsome/css/fontawesome.css" />
  </head>

  <body>
    <div class="container-fluid mt-5">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3>รออนุมัติเข้าสอบ</h3>
          <p>Admin อนุมัติสมาชิกเพื่อเข้ามาสอบ</p>

          <div class="table-responsive mt-3">
            <table
              id="example"
              class="table table-bordered"
              style="width: 100%"
            >
              <thead>
                <tr>
                  <th class="text-center">#</th>
                  <th class="text-center">รหัสพนักงาน</th>
                  <th class="text-center">ชื่อ - นามสกุล</th>
                  <th class="text-center">แผนก</th>
                  <th class="text-center">วันที่</th>
                  <th class="text-center">รอบเวลา</th>
                  <th class="text-center">โรงงาน</th>
                  <th class="text-center">สถานะ</th>
                  <th class="text-center">สถานะ</th>
                  <th class="text-center">จัดการข้อมูล</th>
                  <th class="text-center">หมายเหตุ</th>
                </tr>
              </thead>
              <tbody>
                <tr class="align-middle">
                  <td>1</td>
                  <td class="text-center">3790</td>
                  <td>นาย เทวัน บุญยะบุตร</td>
                  <td>Manufacturing Tasith Factory</td>
                  <td>12 กุมภาพันธ์ 2568</td>
                  <td>09:00 - 10:00 น.</td>
                  <td class="text-center">TS</td>
                  <td>
                    <div class="text-center">
                      <button
                        class="btn btn-sm btn-warning me-2"
                        style="color: white"
                        id="approve-btn-1"
                        onclick="approve(1)"
                      >
                        รออนุมัติ
                      </button>
                    </div>
                  </td>
                  <td>
                    <div class="text-center">
                      <button
                        class="btn btn-sm btn-danger"
                        id="reject-btn-1"
                        onclick="showData(1)"
                      >
                        ยกเลิก
                      </button>
                    </div>
                  </td>
                  <td>
                    <div class="text-center">
                      <button
                        class="btn btn-sm btn-outline-warning"
                        onclick="editdata(1)"
                      >
                        <i class="fas fa-edit"></i> แก้ไขสถานะ
                      </button>
                    </div>
                  </td>
                  <td id="remark-1"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      let table = new DataTable("#example", {
        language: {
          url: "assets/lib/dataTables/language.json",
          info: "",
        },
      });

      //แก้ไขสถานะ
      function editdata(id) {
        const approveBtn = document.getElementById(`approve-btn-${id}`);
        const rejectBtn = document.getElementById(`reject-btn-${id}`);
        let currentStatus = "";

        // ตรวจสอบสถานะปัจจุบันของปุ่ม
        if (approveBtn.classList.contains("btn-success")) {
          currentStatus = "approve"; //อนุมัติ
        } else if (rejectBtn.classList.contains("btn-secondary")) {
          currentStatus = "reject"; //ยกเลิก
        }

        Swal.fire({
          icon: "warning",
          title: "แก้ไขสถานะ",
          html: `
    <div class="row">
      <div class="col-lg-4">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="statusRadioOptions" id="statusRadio1" value="approve" ${
            currentStatus === "approve" ? "checked" : ""
          }>
          <label class="form-check-label" for="statusRadio1" style="font-size:18px;">อนุมัติ</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="statusRadioOptions" id="statusRadio2" value="reject" ${
            currentStatus === "reject" ? "checked" : ""
          }>
          <label class="form-check-label" for="statusRadio2" style="font-size:18px;">ยกเลิก</label>
        </div>
      </div>
    </div>
    `,
          confirmButtonText: "ตกลง",
          confirmButtonColor: "green",
          showCancelButton: true,
          cancelButtonText: "ยกเลิก",
        }).then((result) => {
          if (result.isConfirmed) {
            const selectedStatus = document.querySelector(
              'input[name="statusRadioOptions"]:checked'
            ).value;
            updateStatus(id, selectedStatus);
          }
        });
      }

      function updateStatus(id, status) {
        const approveBtn = document.getElementById(`approve-btn-${id}`);
        const rejectBtn = document.getElementById(`reject-btn-${id}`);
        const editBtn = document.querySelector(
          `button[onclick="editdata(${id})"]`
        );

        if (status === "approve") {
          approveBtn.innerText = "อนุมัติแล้ว";
          approveBtn.classList.remove("btn-warning");
          approveBtn.classList.add("btn-success");
          approveBtn.disabled = true;
          rejectBtn.parentElement.classList.add("d-none"); // ซ่อนปุ่มยกเลิก
          approveBtn.parentElement.classList.remove("d-none");
        } else if (status === "reject") {
          Swal.fire({
            icon: "warning",
            html: `<div class="text-start">
               <textarea id="reason" class="form-control" placeholder="กรุณาระบุเหตุผล"></textarea>
            </div>`,
            confirmButtonText: "ตกลง",
            confirmButtonColor: "green",
            cancelButtonText: "ยกเลิก",
            showCancelButton: true,
            allowOutsideClick: false,
          }).then((result) => {
            if (result.isConfirmed) {
              const reason = document.getElementById("reason").value;
              document.getElementById(`remark-${id}`).innerText = reason;
              rejectBtn.innerText = "ยกเลิกแล้ว";
              rejectBtn.classList.remove("btn-danger");
              rejectBtn.classList.add("btn-secondary");
              rejectBtn.disabled = true;
              approveBtn.parentElement.classList.add("d-none"); // ซ่อนปุ่มอนุมัติ
              rejectBtn.parentElement.classList.remove("d-none"); 
            }
          });
        }
       // editBtn.classList.remove("d-none"); // แสดงปุ่มแก้ถานะ
      }

      // ฟังก์ชันสำหรับการอนุมัติ
      function approve(id) {
        const approveBtn = document.getElementById(`approve-btn-${id}`);
        const rejectBtn = document.getElementById(`reject-btn-${id}`);
        approveBtn.innerText = "อนุมัติแล้ว";
        approveBtn.classList.remove("btn-warning");
        approveBtn.classList.add("btn-success");
        approveBtn.disabled = true;
        rejectBtn.parentElement.classList.add("d-none"); // ซ่อนปุ่มยกเลิก
      }

      // ฟังก์ชันสำหรับการไม่อนุมัติ
      function showData(id) {
        Swal.fire({
          icon: "warning",
          html: `<div class="text-start">
               <textarea id="reason" class="form-control" placeholder="กรุณาระบุเหตุผล"></textarea>
            </div>`,
          confirmButtonText: "ตกลง",
          confirmButtonColor: "green",
          cancelButtonText: "ยกเลิก",
          showCancelButton: true,
          allowOutsideClick: false,
        }).then((result) => {
          if (result.isConfirmed) {
            const reason = document.getElementById("reason").value;
            document.getElementById(`remark-${id}`).innerText = reason;
            const rejectBtn = document.getElementById(`reject-btn-${id}`);
            const approveBtn = document.getElementById(`approve-btn-${id}`);
            rejectBtn.innerText = "ยกเลิกแล้ว";
            rejectBtn.classList.remove("btn-danger");
            rejectBtn.classList.add("btn-secondary");
            rejectBtn.disabled = true;
            approveBtn.parentElement.classList.add("d-none"); // ซ่อนปุ่มอนุมัติ
          }
        });
      }
    </script>
  </body>
</html>
